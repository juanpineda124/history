<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêæ Animal Mystery Detectives</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: 'Trebuchet MS', sans-serif;
            background: linear-gradient(180deg, #204a2e, #0f2417);
            color: #f7f7f7;
            text-align: center;
            padding: 10px;
        }

        h1 {
            font-size: 2em;
            margin-top: 20px;
        }

        #avatarName {
            font-size: 1.2em;
            font-weight: bold;
            color: #a8ffb3;
            margin-top: 10px;
        }

        .section {
            margin-top: 30px;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: 0.3s;
        }

        .btn:hover {
            background: #45a049;
        }

        .map {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px;
        }

        .location {
            background: #276a42;
            padding: 12px 18px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .location:hover {
            background: #368b56;
        }

        #pistas {
            margin-top: 20px;
            background: #163622;
            padding: 15px;
            border-radius: 10px;
        }

        .avatar {
            display: inline-block;
            text-align: center;
            margin: 10px;
        }

        .avatar img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #4CAF50;
            cursor: pointer;
            transition: 0.3s;
        }

        .avatar img:hover {
            transform: scale(1.1);
            border-color: #76ff7a;
        }

        #backBtn {
            position: fixed;
            top: 15px;
            left: 15px;
            background: #ff6347;
            border: none;
            color: white;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: bold;
            display: none;
        }

        #backBtn:hover {
            background: #e14b32;
        }
    </style>
</head>

<body>

    <button id="backBtn" onclick="goHome()">‚¨ÖÔ∏è Home</button>

    <h1>üêæ Animal Mystery Detectives</h1>
    <div id="avatarName"></div>

    <!-- RULES -->
    <div id="rules" class="section">
        <h2>üìú Game Rules</h2>
        <p>Welcome, detective! Each level hides a new mystery in the animal kingdom. Solve them all!</p>
        <ul style="text-align:left; display:inline-block;">
            <li>Click the locations to find <b>3 clues</b>.</li>
            <li>When you think you know, <b>accuse the suspect</b>.</li>
            <li>+10 points for correct guesses, -5 for wrong ones.</li>
        </ul>
        <button class="btn" onclick="showAvatarSelect()">Start Adventure üïµÔ∏è‚Äç‚ôÄÔ∏è</button>
    </div>

    <!-- AVATAR SELECTION -->
    <div id="avatarSelect" class="section" style="display:none;">
        <h2>Choose your detective</h2>
        <div class="avatar" onclick="selectAvatar('ü¶ä Fox Leo')">
            <img src="fox.png" alt="Fox Leo">
            <p>ü¶ä Fox Leo</p>
        </div>
        <div class="avatar" onclick="selectAvatar('ü¶â Owl Mila')">
            <img src="Owl.jpg" alt="Owl Mila">
            <p>ü¶â Owl Mila</p>
        </div>
        <div class="avatar" onclick="selectAvatar('üêØ Tiger Rino')">
            <img src="tiger.jpg" alt="Tiger Rino">
            <p>üêØ Tiger Rino</p>
        </div>
    </div>

    <!-- LEVEL SELECTION -->
    <div id="levelSelect" class="section" style="display:none;">
        <h2>Select a mystery</h2>
        <button class="btn" onclick="startLevel(1)">Level 1</button>
        <button class="btn" onclick="startLevel(2)">Level 2</button>
        <button class="btn" onclick="startLevel(3)">Level 3</button>
    </div>

    <!-- GAME -->
    <div id="game" style="display:none;">
        <h2 id="levelTitle"></h2>
        <h3 id="suspectsList"></h3>
        <div class="map" id="mapLocations"></div>
        <div id="pistas">
            <h3>Clues found:</h3>
            <ul id="listaPistas"></ul>
        </div>
        <button id="btnAccuse" class="btn" style="display:none;" onclick="accuse()">Accuse</button>
        <div id="result"></div>
    </div>

    <script>
        let avatar = null;
        let level = 0;
        let clues = [];
        let culprit = '';
        let culpritName = '';
        let score = 0;

        function normalize(text) {
            return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function goHome() {
            document.getElementById('rules').style.display = 'block';
            document.getElementById('avatarSelect').style.display = 'none';
            document.getElementById('levelSelect').style.display = 'none';
            document.getElementById('game').style.display = 'none';
            document.getElementById('avatarName').innerText = '';
            document.getElementById('backBtn').style.display = 'none';
            avatar = null; score = 0;
        }

        function showAvatarSelect() {
            document.getElementById('rules').style.display = 'none';
            document.getElementById('avatarSelect').style.display = 'block';
            document.getElementById('backBtn').style.display = 'inline-block';
        }

        function selectAvatar(name) {
            avatar = name;
            document.getElementById('avatarSelect').style.display = 'none';
            document.getElementById('levelSelect').style.display = 'block';
            document.getElementById('avatarName').innerText = `Detective ${avatar}`;
        }

        function shuffle(arr) {
            return arr.sort(() => Math.random() - 0.5);
        }

        function startLevel(n) {
            level = n;
            clues = [];
            document.getElementById('levelSelect').style.display = 'none';
            document.getElementById('game').style.display = 'block';
            document.getElementById('listaPistas').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('btnAccuse').style.display = 'none';

            let locations = [];
            let cluesSet = [];
            let suspects = [];

            // ü¶ä FOX CASES
            if (avatar.includes('Fox')) {
                if (level === 1) {
                    document.getElementById('levelTitle').innerText = 'üçé Level 1: The Stolen Apples';
                    culpritName = 'Paco the Raccoon'; culprit = 'raccoon paco';
                    suspects = shuffle(['Lily the Cat', 'Paco the Raccoon', 'Milo the Dog']);
                    locations = shuffle(['Barn', 'River', 'Cave']);
                    cluesSet = [
                        'These paw prints are bigger than a cat‚Äôs.',
                        'The apples near the river are fresher than the others.',
                        'The scarf is dirtier and longer than any other animal‚Äôs.'
                    ];
                } else if (level === 2) {
                    document.getElementById('levelTitle').innerText = 'ü•ï Level 2: The Missing Carrots';
                    culpritName = 'Rita the Rabbit'; culprit = 'rabbit rita';
                    suspects = shuffle(['Pina the Parrot', 'Rita the Rabbit', 'Lolo the Monkey',]);
                    locations = shuffle(['Farm', 'Burrow', 'Forest']);
                    cluesSet = [
                        'This fur is whiter than snow.',
                        'These footprints are smaller than a monkey‚Äôs.',
                        'The note has neater handwriting than before.'
                    ];
                } else {
                    document.getElementById('levelTitle').innerText = 'üçØ Level 3: The Honey Heist';
                    culpritName = 'Benny the Bear'; culprit = 'bear benny';
                    suspects = shuffle(['Sofi the Bee', 'Benny the Bear', 'Nina the Butterfly']);
                    locations = shuffle(['Hive', 'Cave', 'River']);
                    cluesSet = [
                        'These paw marks are heavier than any bee‚Äôs trace.',
                        'The honey jars are stickier than usual.',
                        'This fur is the thickest I‚Äôve ever seen.'
                    ];
                }
            }

            // ü¶â OWL CASES
            else if (avatar.includes('Owl')) {
                if (level === 1) {
                    document.getElementById('levelTitle').innerText = 'üí° Level 1: The Night Light Mystery';
                    culpritName = 'Tina the Firefly'; culprit = 'firefly tina';
                    suspects = shuffle(['Nino the Bat', 'Rex the Frog', 'Tina the Firefly']);
                    locations = shuffle(['Dark Woods', 'Hill', 'Tree Hollow']);
                    cluesSet = [
                        'This glow is brighter than any star.',
                        'The lantern is smaller than the one from last night.',
                        'The note is shorter but sweeter than before.'
                    ];
                } else if (level === 2) {
                    document.getElementById('levelTitle').innerText = 'üéµ Level 2: The Silent Forest';
                    culpritName = 'Sofi the Cricket'; culprit = 'cricket sofi';
                    suspects = shuffle(['Rino the Mouse', 'Sofi the Cricket', 'Kira the Squirrel']);
                    locations = shuffle(['Pond', 'Tree', 'Field']);
                    cluesSet = [
                        'This violin is lighter than the others.',
                        'The chirps near the pond are softer than ever.',
                        'This note is the sweetest I‚Äôve found.'
                    ];
                } else {
                    document.getElementById('levelTitle').innerText = 'üìö Level 3: The Lost Scroll';
                    culpritName = 'Milo the Mouse'; culprit = 'mouse milo';
                    suspects = shuffle(['Toby the Fox', 'Milo the Mouse', 'Ella the Deer']);
                    locations = shuffle(['Library Tree', 'Cave', 'Riverbank']);
                    cluesSet = [
                        'These teeth marks are smaller than a fox‚Äôs.',
                        'This page is older and rougher than the rest.',
                        'The tail hair is thinner than usual.'
                    ];
                }
            }

            // üêØ TIGER CASES
            else if (avatar.includes('Tiger')) {
                if (level === 1) {
                    document.getElementById('levelTitle').innerText = 'üçÉ Level 1: The Jungle Tracks';
                    culpritName = 'Lolo the Monkey'; culprit = 'monkey lolo';
                    suspects = shuffle(['Nina the Butterfly', 'Lolo the Monkey', 'Benny the Bear']);
                    locations = shuffle(['Tree', 'River', 'Cave']);
                    cluesSet = [
                        'These peels are fresher than the rest.',
                        'This vine is longer than any I‚Äôve seen.',
                        'The handprint is smaller than a bear‚Äôs but bigger than a butterfly‚Äôs.'
                    ];
                } else if (level === 2) {
                    document.getElementById('levelTitle').innerText = 'üå∫ Level 2: The Missing Flowers';
                    culpritName = 'Nina the Butterfly'; culprit = 'butterfly nina';
                    suspects = shuffle(['Rex the Frog', 'Nina the Butterfly', 'Sofi the Bee']);
                    locations = shuffle(['Garden', 'Bridge', 'Hill']);
                    cluesSet = [
                        'These petals are brighter than sunlight.',
                        'The powder is lighter than air.',
                        'This ribbon is the most colorful of all.'
                    ];
                } else {
                    document.getElementById('levelTitle').innerText = 'üíé Level 3: The Diamond Leaf';
                    culpritName = 'Rex the Frog'; culprit = 'frog rex';
                    suspects = shuffle(['Paco the Raccoon', 'Lolo the Monkey', 'Rex the Frog']);
                    locations = shuffle(['Pond', 'Tree', 'Cave']);
                    cluesSet = [
                        'These footprints are wetter than usual.',
                        'This leaf is shinier than any gem.',
                        'The pebble is the smoothest in the pond.'
                    ];
                }
            }

            document.getElementById('suspectsList').innerText = "Suspects: " + suspects.join(", ");
            const mapDiv = document.getElementById('mapLocations');
            mapDiv.innerHTML = '';
            locations.forEach((loc, i) => {
                const div = document.createElement('div');
                div.classList.add('location');
                div.textContent = loc;
                div.onclick = () => findClue(cluesSet[i]);
                mapDiv.appendChild(div);
            });
        }

        function findClue(clue) {
            if (!clues.includes(clue)) {
                clues.push(clue);
                const li = document.createElement('li');
                li.textContent = clue;
                document.getElementById('listaPistas').appendChild(li);
            }
            if (clues.length >= 3) document.getElementById('btnAccuse').style.display = 'inline-block';
        }

        function accuse() {
            const suspect = prompt('Who do you think is the culprit?');
            if (!suspect) return;
            const resp = normalize(suspect);
            const cul = normalize(culprit);

            if (cul.includes(resp) || resp.includes(cul.split(' ')[0]) || resp.includes(cul.split(' ')[1])) {
                score += 10;
                document.getElementById('result').innerHTML = `<h3>üéâ Correct! The culprit is ${culpritName}!</h3><p>+10 points</p>`;
                if (level < 3) {
                    document.getElementById('result').innerHTML += `<button class="btn" onclick="startLevel(${level + 1})">‚û°Ô∏è Next Level</button>`;
                } else {
                    document.getElementById('result').innerHTML += `<button class="btn" onclick="generateCertificate()">üèÜ Generate Certificate</button>`;
                }
            } else {
                score -= 5;
                document.getElementById('result').innerHTML = `<h3>‚ùå Wrong guess. Try again.</h3><p>-5 points</p>`;
            }
        }

        function generateCertificate() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });

            // Background color
            doc.setFillColor(240, 255, 245);
            doc.rect(0, 0, 210, 297, "F");

            // Border
            doc.setDrawColor(100, 180, 100);
            doc.setLineWidth(2);
            doc.rect(10, 10, 190, 277);

            // Title banner
            doc.setFillColor(200, 240, 210);
            doc.rect(0, 25, 210, 20, "F");

            // Title (centered and clean)
            doc.setFontSize(26);
            doc.setTextColor(34, 85, 44);
            doc.text("Animal Detective Certificate", 105, 40, { align: "center" });

            // Main text
            doc.setFont("helvetica", "normal");
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);

            // Clean avatar name (remove emojis/special chars)
            const avatarName = (avatar || "Unknown Detective").replace(/[^\x00-\x7F]/g, "");
            const rank = score >= 25 ? "Master Detective" : "Junior Detective";
            const date = new Date().toLocaleDateString();

            doc.text(`Awarded to: ${avatarName}`, 30, 80);
            doc.text(`Total Score: ${score}`, 30, 100);
            doc.text(`Rank: ${rank}`, 30, 120);
            doc.text(`Date: ${date}`, 30, 140);

            // Centered congratulations message
            doc.setFontSize(14);
            doc.text(
                "Congratulations on solving all the mysteries of the Animal Kingdom!",
                105,
                180,
                { align: "center", maxWidth: 160 }
            );

            // Paw watermark (simple, no emoji to avoid encoding issues)
            doc.setFontSize(60);
            doc.setTextColor(210, 235, 210);
            doc.text("*", 150, 250); // Decorative mark

            // Save PDF
            doc.save("Animal_Detective_Certificate.pdf");
        }
    </script>
</body>

</html>